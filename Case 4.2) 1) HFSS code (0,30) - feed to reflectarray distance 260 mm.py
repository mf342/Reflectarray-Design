# ----------------------------------------------
# Script Recorded by Ansys Electronics Desktop Student Version 2023.2.0
# 0:22:55  Nov 17, 2023
# ----------------------------------------------
import ScriptEnv

ScriptEnv.Initialize("Ansoft.ElectronicsDesktop")
oDesktop.RestoreWindow()
oProject = oDesktop.SetActiveProject("HFSS reflectarray design (only patches) (0, 30)")
oDesign = oProject.SetActiveDesign("HFSSDesign1")
oEditor = oDesign.SetActiveEditor("3D Modeler")

#------------------------------------------------------------
oProject.ChangeProperty([
    "NAME:AllTabs",
    [
        "NAME:ProjectVariableTab", ["NAME:PropServers", "ProjectVariables"],
        [
            "NAME:DeletedProps", "$a", "$side_length", "$p", "$h",
            "$rogers3003", "$space", "$element_spacing"
        ]
    ]
])
#-------------------------------------------------------------------
#dimensions for antenna assigned as variable
oProject.ChangeProperty([
    "NAME:AllTabs",
    [
        "NAME:ProjectVariableTab",
        ["NAME:PropServers", "ProjectVariables"],
        [
            "NAME:NewProps",
            [
                "NAME:$a",  # Renamed from $a to $side_length
                "PropType:=",
                "VariableProp",
                "UserDef:=",
                True,
                "Value:=",
                "300mm"
            ],
            [
                "NAME:$side_length",  # Renamed from $a to $side_length
                "PropType:=",
                "VariableProp",
                "UserDef:=",
                True,
                "Value:=",
                "300mm"
            ],
            [
                "NAME:$p", "PropType:=", "VariableProp", "UserDef:=", True,
                "Value:=", "7.125mm"
            ],
            [
                "NAME:$h", "PropType:=", "VariableProp", "UserDef:=", True,
                "Value:=", "-260mm"
            ],
            [
                "NAME:$rogers3003", "PropType:=", "VariableProp", "UserDef:=",
                True, "Value:=", "0.762mm"
            ],
            [
                "NAME:$space", "PropType:=", "VariableProp", "UserDef:=", True,
                "Value:=", "14.25mm"
            ],
            [
                "NAME:$element_spacing",
                "PropType:=",
                "VariableProp",
                "UserDef:=",
                True,
                "Value:=",
                "7.125mm"  # Example value, replace with your actual value
            ]
        ]
    ]
])

#-----------------------------------------------------------------------------------------------------

#Ground plane
#oEditor.CreateRectangle(
#   [
#       "NAME:RectangleParameters",
#      "IsCovered:=", True,
#     "XStart:=", "-$side_length/2",
#"YStart:="		, "-$a/2",
#"ZStart:="		, "$h",
#"Width:="		, "$a",
#"Height:="		, "$a",
#"WhichAxis:="		, "Z"
#],
#[
#    "NAME:Attributes",
#   "Name:="		, "Ground",
#  "Flags:="		, "",
# "Color:="		, "(192 192 0)",
#"Transparency:="	, 0,
#"PartCoordinateSystem:=", "Global",
#"UDMId:="		, "",
#"MaterialValue:="	, "\"copper\"",
#"SurfaceMaterialValue:=", "\"\"",
#"SolveInside:="		, True,
#"ShellElement:="	, False,
#"ShellElementThickness:=", "0mm",
#"ReferenceTemperature:=", "20cel",
#"IsMaterialEditable:="	, True,
#"UseMaterialAppearance:=", False,
#"IsLightweight:="	, False
#])

#---------------------------------------------------------------

#Substrate
#rogers 3003 but temporarily it is 0.762mm so as to match CST
#oDefinitionManager = oProject.GetDefinitionManager()
#oDefinitionManager.AddMaterial(
#  [
#    "NAME:Rogers3003",
#    "CoordinateSystemType:=", "Cartesian",
#    "BulkOrSurfaceType:="	, 1,
#    [
#      "NAME:PhysicsTypes",
#      "set:="			, ["Electromagnetic"]
#    ],
#    "permittivity:="	, "3.48",
#    "dielectric_loss_tangent:=", "0.0037",
#    "delta_H_freq:="	, "10GHz"
#  ])

#oEditor.CreateBox(
#  [
#    "NAME:BoxParameters",
#    "XPosition:="		, "-$side_length/2",
#    "YPosition:="		, "-$a/2",
#    "ZPosition:="		, "$h - $rogers3003",
#    "XSize:="		, "$a",
#    "YSize:="		, "$a",
#    "ZSize:="		, "$rogers3003"
#  ],
#  [
#    "NAME:Attributes",
#    "Name:="		, "Substrate",
#    "Flags:="		, "",
#    "Color:="		, "(143 175 143)",
#    "Transparency:="	, 0,
#    "PartCoordinateSystem:=", "Global",
#    "UDMId:="		, "",
#    "MaterialValue:="	, "\"Rogers3003\"",
#    "SurfaceMaterialValue:=", "\"\"",
#    "SolveInside:="		, True,
#    "ShellElement:="	, False,
#    "ShellElementThickness:=", "0mm",
#    "ReferenceTemperature:=", "20cel",
#    "IsMaterialEditable:="	, True,
#    "UseMaterialAppearance:=", False,
#    "IsLightweight:="	, False
#  ])

#-------------------------------------------------------------------
sizes = [7.897596990540493, 7.346549412454626, 7.68203037646619, 7.197206495039122, 7.519048033614463, 10.690371901980594, 7.3479225282731715, 7.561610466738381, 13.776578953062236, 7.262590946298587, 7.450705046558673, 7.61237696809274, 8.26122595965426, 6.881349866847287, 7.251955768239299, 7.367374290571111, 7.425358954991018, 7.473477166379972, 7.508921654685746, 7.5307993674616, 7.539970653507444, 6.891911833269471, 7.493450236350164, 1.577246887862826, 7.416780909634538, 7.8184362772715374, 7.236618381167848, 7.509413928090548, 8.23569856868756, 7.233307605852185, 7.455042755314195, 7.656706161104153, 10.231102881068743, 7.168123497828522, 7.357678807082916, 7.445797249343238, 7.524517596018377, 7.586897761379234, 7.677268337388775, 7.749038418586979, 7.8267951027648675, 7.850215923510557, 7.32320152829464, 7.677974136403807, 7.23479515035194, 7.558243378285985, 6.705964737661372, 7.424490736553729, 7.742453391257402, 7.110937472682684, 7.428214525893093, 7.638252968683018, 6.188061803084004, 7.224316280550087, 7.401867806640219, 7.506774639958746, 7.612223513101214, 7.79682656235001, 8.340036511135574, 6.868698440389119, 6.035226091162736, 6.590261986407366, 6.633819316278228, 7.443555200984442, 12.849076867462816, 7.406644410770766, 7.856310340492442, 7.30044935066091, 7.561045456316601, 5.556219475966925, 7.371841892334856, 7.569972694540618, 11.80214655659793, 7.2139873272565245, 7.41244629289655, 7.538164355166963, 7.707248923586377, 8.445893178230866, 6.320016932899164, 7.044640179455598, 7.18726199146742, 7.240547753376199, 7.264889854057668, 7.262390603062784, 7.5508563729881155, 7.046242836932021, 7.514321725305981, 5.983380865836801, 7.422484225957902, 7.824799765897855, 7.219287162847052, 7.48907878329252, 7.886828534136562, 7.102659110685657, 7.394201308188228, 7.536624940019592, 7.748441473893002, 9.267783602312138, 7.00957817978657, 7.237169497295587, 7.331661839472601, 7.372966489829929, 7.393701564439416, 7.403292905142338, 7.398641621981011, 7.699126529508985, 7.300104433463562, 7.637571738776162, 7.181105880270646, 7.524786527961407, 2.9385741830572623, 7.380039671443279, 7.607855800950117, 5.877923601894865, 7.338716195363099, 7.499005046640871, 7.705006241900702, 8.864891055396187, 7.095354723696069, 7.306650286250513, 7.387253584614548, 7.432359921534152, 7.465620438195637, 7.486360414736862, 7.492709256644724, 7.485789028987591, 8.106499620941515, 7.3900170597340304, 7.87690663367192, 7.336314918779172, 7.633416991358717, 7.068737754064708, 7.459626366654047, 7.850275179665761, 7.15947009166698, 7.424346388597682, 7.595152778944588, 8.433474154826353, 7.026787255133562, 7.308667583453665, 7.403252485434195, 7.464985013456897, 7.516060361719694, 7.550322794391519, 7.568922074207066, 7.573030606837855, 7.563810226085963, 5.412668538959087, 7.445454166609682, 12.52542236034319, 7.401624371393327, 7.8083170542644815, 7.257889211738938, 7.530813386014525, 14.780638848660727, 7.306159097143261, 7.496073492944271, 7.748189445042788, 6.26272477870871, 7.2438842448846525, 7.389145470338223, 7.467196707267217, 7.534897270115, 7.584503801413482, 7.644568173816481, 7.677799520800482, 7.682324368020483, 7.66049618476377, 6.654378073635536, 7.491093674748715, 5.889720141034092, 7.443622475181981, 8.192550947193768, 7.33948120606011, 7.582296030501965, 6.270390482288665, 7.366980908448018, 7.5492551180549, 8.061288633163057, 7.019094725410315, 7.333748921063292, 7.435340499641696, 7.518679351754656, 7.585435495770133, 7.677695846789377, 7.7468943433213635, 7.812767480560464, 7.816833961928732, 7.764243808152331, 6.93628922965637, 7.518659434061504, 6.76179990421973, 7.47190682461919, 13.367602245398434, 7.370759817674584, 7.637283666296644, 6.861011643516171, 7.39685358972364, 7.5814530893757, 8.964595970387863, 7.157705349779126, 7.367190604774016, 7.464265153570617, 7.549830906541188, 7.642325492130808, 7.740387264924257, 7.870184755663623, 7.97499595169266, 7.97607990403566, 7.877235802056963, 6.997643954215868, 7.52787881982227, 6.862358715026519, 7.481665824970649, 11.8898397456001, 7.383246185324634, 7.657833528714485, 6.945069388082928, 7.408472129331316, 7.595482463997786, 14.780638848648168, 7.179837597575432, 7.379395439846326, 7.474854065721531, 7.560259259748005, 7.66248894677615, 7.782686588312247, 7.937311644030376, 8.059572677972659, 8.058042473100675, 7.943648530156795, 6.93628922965637, 7.518659434061504, 6.76179990421973, 7.47190682461919, 13.367602245398434, 7.370759817674584, 7.637283666296644, 6.861011643516171, 7.39685358972364, 7.5814530893757, 8.964595970387863, 7.157705349779126, 7.367190604774016, 7.464265153570617, 7.549830906541188, 7.642325492130808, 7.740387264924257, 7.870184755663623, 7.97499595169266, 7.97607990403566, 7.877235802056963, 6.654378073635536, 7.491093674748715, 5.889720141034092, 7.443622475181981, 8.192550947193768, 7.33948120606011, 7.582296030501965, 6.270390482288665, 7.366980908448018, 7.5492551180549, 8.061288633163057, 7.019094725410315, 7.333748921063292, 7.435340499641696, 7.518679351754656, 7.585435495770133, 7.677695846789377, 7.7468943433213635, 7.812767480560464, 7.816833961928732, 7.764243808152331, 5.412668538959087, 7.445454166609682, 12.52542236034319, 7.401624371393327, 7.8083170542644815, 7.257889211738938, 7.530813386014525, 14.780638848660727, 7.306159097143261, 7.496073492944271, 7.748189445042788, 6.26272477870871, 7.2438842448846525, 7.389145470338223, 7.467196707267217, 7.534897270115, 7.584503801413482, 7.644568173816481, 7.677799520800486, 7.682324368020483, 7.66049618476377, 8.106499620941515, 7.3900170597340304, 7.87690663367192, 7.336314918779172, 7.633416991358717, 7.068737754064708, 7.459626366654047, 7.850275179665761, 7.15947009166698, 7.424346388597682, 7.595152778944588, 8.433474154826353, 7.026787255133562, 7.308667583453665, 7.403252485434195, 7.464985013456897, 7.516060361719694, 7.550322794391519, 7.568922074207066, 7.573030606837855, 7.563810226085963, 7.699126529508985, 7.300104433463562, 7.637571738776162, 7.181105880270646, 7.524786527961407, 2.9385741830572623, 7.380039671443279, 7.607855800950117, 5.877923601894865, 7.338716195363099, 7.499005046640871, 7.705006241900702, 8.864891055396187, 7.095354723696069, 7.306650286250513, 7.387253584614548, 7.432359921534152, 7.465620438195637, 7.486360414736862, 7.492709256644724, 7.485789028987591, 7.5508563729881155, 7.046242836932021, 7.514321725305981, 5.983380865836801, 7.422484225957902, 7.824799765897855, 7.219287162847052, 7.48907878329252, 7.886828534136562, 7.102659110685657, 7.394201308188228, 7.536624940019592, 7.748441473893002, 9.267783602312138, 7.00957817978657, 7.237169497295587, 7.331661839472601, 7.372966489829929, 7.393701564439416, 7.403292905142338, 7.398641621981011, 7.443555200984442, 12.849076867462816, 7.406644410770766, 7.856310340492442, 7.30044935066091, 7.561045456316601, 5.556219475966925, 7.371841892334856, 7.569972694540618, 11.80214655659793, 7.2139873272565245, 7.41244629289655, 7.538164355166963, 7.707248923586377, 8.445893178230888, 6.320016932899164, 7.044640179455598, 7.187261991467421, 7.240547753376199, 7.264889854057668, 7.262390603062784, 7.32320152829464, 7.677974136403807, 7.23479515035194, 7.558243378285985, 6.705964737661372, 7.424490736553729, 7.742453391257402, 7.11093747268268, 7.428214525893092, 7.638252968683017, 6.188061803084004, 7.224316280550085, 7.401867806640218, 7.506774639958746, 7.612223513101214, 7.79682656235001, 8.340036511135574, 6.868698440389119, 6.035226091162736, 6.590261986407366, 6.633819316278206, 6.891911833269471, 7.493450236350164, 1.577246887862826, 7.416780909634538, 7.8184362772715374, 7.236618381167848, 7.509413928090548, 8.23569856868756, 7.233307605852185, 7.455042755314195, 7.656706161104153, 10.231102881068743, 7.168123497828522, 7.357678807082916, 7.445797249343238, 7.524517596018377, 7.586897761379234, 7.677268337388775, 7.749038418586979, 7.8267951027648675, 7.850215923510557]



# Truncated for brevity
num_rows = 21
num_cols = 21

# Initialize variables for position calculation
x_offset = 0
y_offset = 0

# Iterate over each row and column to create patches with variable sizes
for i in range(num_cols):
  for j in range(num_rows):
    # Calculate the index in the sizes list
     index = (i * num_cols + j) % len(sizes)
    # Fetch the patch size for the current patch
     current_patch_size = sizes[index]

    # Calculate the center positions
     x_center = 7.125 + (
        i * 14.25)  # 15 mm from the edge, plus 30 mm for each subsequent patch
     y_center = 7.125 + (j * 14.25)  # same calculation for y

    # Calculate the start positions (top left corner of the patch)
     x_start = "-$a/2 + {}mm - {}mm/2".format(
        x_center, current_patch_size)  # Adjust x_start for patch center
     y_start = "-$a/2 + {}mm - {}mm/2".format(
        y_center, current_patch_size)  # Adjust y_start for patch center

    # Create the patch
     oEditor.CreateRectangle([
        "NAME:RectangleParameters", "IsCovered:=", True, "XStart:=", x_start,
        "YStart:=", y_start, "ZStart:=", "$h", "Width:=",
        "{}mm".format(current_patch_size), "Height:=",
        "{}mm".format(current_patch_size), "WhichAxis:=", "Z"
     ], [
        "NAME:Attributes", "Name:=", "Rectangle{}_{}".format(i, j), "Flags:=",
        "", "Color:=", "(192 192 0)", "Transparency:=", 0,
        "PartCoordinateSystem:=", "Global", "UDMId:=", "", "MaterialValue:=",
        "\"copper\"", "SurfaceMaterialValue:=", "\"\"", "SolveInside:=", True,
        "ShellElement:=", False, "ShellElementThickness:=", "0mm",
        "ReferenceTemperature:=", "20cel", "IsMaterialEditable:=", True,
        "UseMaterialAppearance:=", False, "IsLightweight:=", False
     ])
#oEditor.ThickenSheet(
#  [
#    "NAME:Selections",
#    "Selections:="		, "Ground",
#    "NewPartsModelFlag:="	, "Model"
#  ],
#  [
#    "NAME:SheetThickenParameters",
#    "Thickness:="		, "0.035mm",
#    "BothSides:="		, False,
#    [
#     "NAME:ThickenAdditionalInfo",
#      [
#        "NAME:ShellThickenDirectionInfo",
#        "SampleFaceID:="	, 103741,
#        "ComponentSense:="	, True,
#        [
#          "NAME:PointOnSampleFace",
#          "X:="			, "2.20719cm",
#          "Y:="			, "2.20719cm",
#          "Z:="			, "20cm"
#        ],
#        [
#          "NAME:DirectionAtPoint",
#          "X:="			, "-0cm",
#          "Y:="			, "0cm",
#          "Z:="			, "1cm"
#        ]
#      ]
#    ]
#  ])