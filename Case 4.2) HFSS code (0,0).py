# ----------------------------------------------
# Script Recorded by Ansys Electronics Desktop Student Version 2023.2.0
# 0:22:55  Nov 17, 2023
# ----------------------------------------------
import ScriptEnv

ScriptEnv.Initialize("Ansoft.ElectronicsDesktop")
oDesktop.RestoreWindow()
oProject = oDesktop.SetActiveProject("HFSS reflectarray design (only patches) (0, 0) - feed to reflectarray distance 260 mm")
oDesign = oProject.SetActiveDesign("HFSSDesign1")
oEditor = oDesign.SetActiveEditor("3D Modeler")

#------------------------------------------------------------
oProject.ChangeProperty([
    "NAME:AllTabs",
    [
        "NAME:ProjectVariableTab", ["NAME:PropServers", "ProjectVariables"],
        [
            "NAME:DeletedProps", "$a", "$side_length", "$p", "$h",
            "$rogers3003", "$space", "$element_spacing"
        ]
    ]
])
#-------------------------------------------------------------------
#dimensions for antenna assigned as variable
oProject.ChangeProperty([
    "NAME:AllTabs",
    [
        "NAME:ProjectVariableTab",
        ["NAME:PropServers", "ProjectVariables"],
        [
            "NAME:NewProps",
            [
                "NAME:$a",  # Renamed from $a to $side_length
                "PropType:=",
                "VariableProp",
                "UserDef:=",
                True,
                "Value:=",
                "300mm"
            ],
            [
                "NAME:$side_length",  # Renamed from $a to $side_length
                "PropType:=",
                "VariableProp",
                "UserDef:=",
                True,
                "Value:=",
                "300mm"
            ],
            [
                "NAME:$p", "PropType:=", "VariableProp", "UserDef:=", True,
                "Value:=", "7.125mm"
            ],
            [
                "NAME:$h", "PropType:=", "VariableProp", "UserDef:=", True,
                "Value:=", "-260mm"
            ],
            [
                "NAME:$rogers3003", "PropType:=", "VariableProp", "UserDef:=",
                True, "Value:=", "0.762mm"
            ],
            [
                "NAME:$space", "PropType:=", "VariableProp", "UserDef:=", True,
                "Value:=", "14.25mm"
            ],
            [
                "NAME:$element_spacing",
                "PropType:=",
                "VariableProp",
                "UserDef:=",
                True,
                "Value:=",
                "7.125mm"  # Example value, replace with your actual value
            ]
        ]
    ]
])

#-----------------------------------------------------------------------------------------------------

#Ground plane
#oEditor.CreateRectangle(
#   [
#       "NAME:RectangleParameters",
#      "IsCovered:=", True,
#     "XStart:=", "-$side_length/2",
#"YStart:="		, "-$a/2",
#"ZStart:="		, "$h",
#"Width:="		, "$a",
#"Height:="		, "$a",
#"WhichAxis:="		, "Z"
#],
#[
#    "NAME:Attributes",
#   "Name:="		, "Ground",
#  "Flags:="		, "",
# "Color:="		, "(192 192 0)",
#"Transparency:="	, 0,
#"PartCoordinateSystem:=", "Global",
#"UDMId:="		, "",
#"MaterialValue:="	, "\"copper\"",
#"SurfaceMaterialValue:=", "\"\"",
#"SolveInside:="		, True,
#"ShellElement:="	, False,
#"ShellElementThickness:=", "0mm",
#"ReferenceTemperature:=", "20cel",
#"IsMaterialEditable:="	, True,
#"UseMaterialAppearance:=", False,
#"IsLightweight:="	, False
#])

#---------------------------------------------------------------

#Substrate
#rogers 3003 but temporarily it is 0.762mm so as to match CST
#oDefinitionManager = oProject.GetDefinitionManager()
#oDefinitionManager.AddMaterial(
#  [
#    "NAME:Rogers3003",
#    "CoordinateSystemType:=", "Cartesian",
#    "BulkOrSurfaceType:="	, 1,
#    [
#      "NAME:PhysicsTypes",
#      "set:="			, ["Electromagnetic"]
#    ],
#    "permittivity:="	, "3.48",
#    "dielectric_loss_tangent:=", "0.0037",
#    "delta_H_freq:="	, "10GHz"
#  ])

#oEditor.CreateBox(
#  [
#    "NAME:BoxParameters",
#    "XPosition:="		, "-$side_length/2",
#    "YPosition:="		, "-$a/2",
#    "ZPosition:="		, "$h - $rogers3003",
#    "XSize:="		, "$a",
#    "YSize:="		, "$a",
#    "ZSize:="		, "$rogers3003"
#  ],
#  [
#    "NAME:Attributes",
#    "Name:="		, "Substrate",
#    "Flags:="		, "",
#    "Color:="		, "(143 175 143)",
#    "Transparency:="	, 0,
#    "PartCoordinateSystem:=", "Global",
#    "UDMId:="		, "",
#    "MaterialValue:="	, "\"Rogers3003\"",
#    "SurfaceMaterialValue:=", "\"\"",
#    "SolveInside:="		, True,
#    "ShellElement:="	, False,
#    "ShellElementThickness:=", "0mm",
#    "ReferenceTemperature:=", "20cel",
#    "IsMaterialEditable:="	, True,
#    "UseMaterialAppearance:=", False,
#    "IsLightweight:="	, False
#  ])

#-------------------------------------------------------------------
sizes = [7.268285981190301, 7.43782946600003, 7.572538333433058, 7.876822560264363, 5.608167306069641, 7.156694706934993, 7.309751621000996, 7.381778751253824, 7.422926287840603, 7.443644130412494, 7.450705046558673, 7.443644130412494, 7.422926287840603, 7.381778751253824, 7.309751621000996, 7.156694706934993, 5.608167306069641, 7.876822560264363, 7.572538333433057, 7.43782946600003, 7.268285981190301, 7.43782946600003, 7.588875254471127, 8.195145195842391, 6.943989505561962, 7.300368421771918, 7.404606868053006, 7.477605588716893, 7.540879184730644, 7.586518692869676, 7.638538660905091, 7.656706161104153, 7.638538660905091, 7.586518692869676, 7.540879184730644, 7.477605588716893, 7.404606868053006, 7.300368421771918, 6.943989505561962, 8.195145195842391, 7.588875254471127, 7.43782946600003, 7.572538333433058, 8.195145195842391, 7.047709146621125, 7.342334459716429, 7.450705046558673, 7.549977093484172, 7.67490426287111, 7.887221886417676, 8.5595750421755, 10.293796162103565, 6.188061803084004, 10.293796162103565, 8.5595750421755, 7.887221886417676, 7.67490426287111, 7.549977093484172, 7.450705046558673, 7.342334459716429, 7.047709146621125, 8.195145195842391, 7.572538333433058, 7.876822560264363, 6.943989505561962, 7.342334459716429, 7.468624478292313, 7.586518692869676, 7.843612320435613, 10.293796162103565, 6.795742052466183, 7.109167578503587, 7.193988429305904, 7.2139873272565245, 7.193988429305904, 7.109167578503587, 6.795742052466183, 10.293796162103565, 7.843612320435613, 7.586518692869676, 7.468624478292313, 7.342334459716429, 6.943989505561962, 7.876822560264363, 5.608167306069641, 7.300368421771918, 7.450705046558673, 7.586518692869676, 7.957218250662381, 6.107252070810335, 7.15019642199895, 7.293880172729779, 7.356433712112832, 7.38778769915839, 7.394201308188228, 7.38778769915839, 7.356433712112832, 7.293880172729779, 7.15019642199895, 6.107252070810335, 7.957218250662381, 7.586518692869676, 7.450705046558673, 7.300368421771918, 5.608167306069641, 7.156694706934993, 7.404606868053006, 7.549977093484172, 7.843612320435613, 6.107252070810335, 7.193988429305904, 7.34403996185068, 7.411473332179139, 7.458202138275516, 7.488772782179153, 7.499005046640871, 7.488772782179153, 7.458202138275516, 7.411473332179139, 7.34403996185068, 7.193988429305904, 6.107252070810335, 7.843612320435613, 7.549977093484172, 7.404606868053006, 7.156694706934993, 7.309751621000996, 7.477605588716893, 7.67490426287111, 10.293796162103565, 7.15019642199895, 7.34403996185068, 7.429501194815434, 7.499005046640871, 7.5504876911283105, 7.581639245914842, 7.595152778944588, 7.581639245914842, 7.5504876911283105, 7.499005046640871, 7.429501194815434, 7.34403996185068, 7.15019642199895, 10.293796162103565, 7.67490426287111, 7.477605588716893, 7.309751621000996, 7.381778751253824, 7.540879184730644, 7.887221886417676, 6.795742052466183, 7.293880172729779, 7.411473332179139, 7.499005046640871, 7.571233238617766, 7.657069436579087, 7.71939284722565, 7.748189445042788, 7.71939284722565, 7.657069436579087, 7.571233238617766, 7.499005046640871, 7.411473332179139, 7.293880172729779, 6.795742052466183, 7.887221886417663, 7.540879184730644, 7.381778751253824, 7.422926287840603, 7.586518692869676, 8.5595750421755, 7.109167578503587, 7.356433712112832, 7.458202138275516, 7.5504876911283105, 7.657069436579087, 7.793048110145036, 7.96701334787896, 8.061288633163057, 7.96701334787896, 7.793048110145036, 7.657069436579087, 7.5504876911283105, 7.458202138275516, 7.356433712112832, 7.109167578503587, 8.559575042175469, 7.586518692869676, 7.422926287840603, 7.443644130412494, 7.638538660905091, 10.293796162103565, 7.193988429305904, 7.38778769915839, 7.488772782179153, 7.581639245914842, 7.71939284722565, 7.96701334787896, 8.42877413547244, 8.964595970387863, 8.42877413547244, 7.96701334787896, 7.71939284722565, 7.581639245914842, 7.488772782179153, 7.38778769915839, 7.193988429305904, 10.293796162103565, 7.638538660905091, 7.443644130412494, 7.450705046558673, 7.656706161104153, 6.188061803084004, 7.2139873272565245, 7.394201308188228, 7.499005046640871, 7.595152778944588, 7.748189445042788, 8.061288633163057, 8.964595970387863, 14.780638848648168, 8.964595970387863, 8.061288633163057, 7.748189445042788, 7.595152778944588, 7.499005046640871, 7.394201308188228, 7.2139873272565245, 6.188061803084004, 7.656706161104153, 7.450705046558673, 7.443644130412494, 7.638538660905091, 10.293796162103565, 7.193988429305904, 7.38778769915839, 7.488772782179153, 7.581639245914842, 7.71939284722565, 7.96701334787896, 8.42877413547244, 8.964595970387863, 8.42877413547244, 7.96701334787896, 7.71939284722565, 7.581639245914842, 7.488772782179153, 7.38778769915839, 7.193988429305904, 10.293796162103565, 7.638538660905091, 7.443644130412494, 7.422926287840603, 7.586518692869676, 8.5595750421755, 7.109167578503587, 7.356433712112832, 7.458202138275516, 7.5504876911283105, 7.657069436579087, 7.793048110145036, 7.96701334787896, 8.061288633163057, 7.96701334787896, 7.793048110145036, 7.657069436579087, 7.5504876911283105, 7.458202138275516, 7.356433712112832, 7.109167578503587, 8.559575042175469, 7.586518692869676, 7.422926287840603, 7.381778751253824, 7.540879184730644, 7.887221886417676, 6.795742052466183, 7.293880172729779, 7.411473332179139, 7.499005046640871, 7.571233238617766, 7.657069436579087, 7.71939284722565, 7.748189445042788, 7.71939284722565, 7.657069436579087, 7.571233238617766, 7.499005046640871, 7.411473332179139, 7.293880172729779, 6.795742052466183, 7.887221886417676, 7.540879184730644, 7.381778751253824, 7.309751621000996, 7.477605588716893, 7.67490426287111, 10.293796162103565, 7.15019642199895, 7.34403996185068, 7.429501194815434, 7.499005046640871, 7.5504876911283105, 7.581639245914842, 7.595152778944588, 7.581639245914842, 7.5504876911283105, 7.499005046640871, 7.429501194815434, 7.34403996185068, 7.15019642199895, 10.293796162103565, 7.67490426287111, 7.477605588716893, 7.309751621000996, 7.156694706934993, 7.404606868053006, 7.549977093484172, 7.843612320435613, 6.107252070810335, 7.193988429305904, 7.34403996185068, 7.411473332179139, 7.458202138275516, 7.488772782179153, 7.499005046640871, 7.488772782179153, 7.458202138275516, 7.411473332179139, 7.34403996185068, 7.193988429305904, 6.107252070810335, 7.843612320435613, 7.549977093484172, 7.404606868053006, 7.156694706934993, 5.608167306069641, 7.300368421771918, 7.450705046558673, 7.586518692869676, 7.957218250662381, 6.107252070810335, 7.15019642199895, 7.293880172729779, 7.356433712112832, 7.38778769915839, 7.394201308188228, 7.38778769915839, 7.356433712112832, 7.293880172729779, 7.15019642199895, 6.107252070810335, 7.957218250662381, 7.586518692869676, 7.450705046558673, 7.300368421771918, 5.608167306069641, 7.876822560264363, 6.943989505561962, 7.342334459716429, 7.468624478292313, 7.586518692869676, 7.843612320435613, 10.293796162103565, 6.795742052466183, 7.109167578503587, 7.193988429305904, 7.2139873272565245, 7.193988429305904, 7.109167578503587, 6.795742052466183, 10.293796162103565, 7.843612320435613, 7.586518692869676, 7.468624478292314, 7.342334459716429, 6.943989505561962, 7.876822560264363, 7.572538333433057, 8.195145195842391, 7.047709146621125, 7.342334459716429, 7.450705046558673, 7.549977093484172, 7.67490426287111, 7.887221886417663, 8.559575042175469, 10.293796162103565, 6.188061803084004, 10.293796162103565, 8.559575042175469, 7.887221886417676, 7.67490426287111, 7.549977093484172, 7.450705046558673, 7.342334459716429, 7.047709146621125, 8.195145195842391, 7.572538333433057, 7.43782946600003, 7.588875254471127, 8.195145195842391, 6.943989505561962, 7.300368421771918, 7.404606868053006, 7.477605588716893, 7.540879184730644, 7.586518692869676, 7.638538660905091, 7.656706161104153, 7.638538660905091, 7.586518692869676, 7.540879184730644, 7.477605588716893, 7.404606868053006, 7.300368421771918, 6.943989505561962, 8.195145195842391, 7.588875254471127, 7.43782946600003]



# Truncated for brevity
num_rows = 21
num_cols = 21

# Initialize variables for position calculation
x_offset = 0
y_offset = 0

# Iterate over each row and column to create patches with variable sizes
for i in range(num_cols):
  for j in range(num_rows):
    # Calculate the index in the sizes list
     index = (i * num_cols + j) % len(sizes)
    # Fetch the patch size for the current patch
     current_patch_size = sizes[index]

    # Calculate the center positions
     x_center = 7.125 + (
        i * 14.25)  # 15 mm from the edge, plus 30 mm for each subsequent patch
     y_center = 7.125 + (j * 14.25)  # same calculation for y

    # Calculate the start positions (top left corner of the patch)
     x_start = "-$a/2 + {}mm - {}mm/2".format(
        x_center, current_patch_size)  # Adjust x_start for patch center
     y_start = "-$a/2 + {}mm - {}mm/2".format(
        y_center, current_patch_size)  # Adjust y_start for patch center

    # Create the patch
     oEditor.CreateRectangle([
        "NAME:RectangleParameters", "IsCovered:=", True, "XStart:=", x_start,
        "YStart:=", y_start, "ZStart:=", "$h", "Width:=",
        "{}mm".format(current_patch_size), "Height:=",
        "{}mm".format(current_patch_size), "WhichAxis:=", "Z"
     ], [
        "NAME:Attributes", "Name:=", "Rectangle{}_{}".format(i, j), "Flags:=",
        "", "Color:=", "(192 192 0)", "Transparency:=", 0,
        "PartCoordinateSystem:=", "Global", "UDMId:=", "", "MaterialValue:=",
        "\"copper\"", "SurfaceMaterialValue:=", "\"\"", "SolveInside:=", True,
        "ShellElement:=", False, "ShellElementThickness:=", "0mm",
        "ReferenceTemperature:=", "20cel", "IsMaterialEditable:=", True,
        "UseMaterialAppearance:=", False, "IsLightweight:=", False
     ])
#oEditor.ThickenSheet(
#  [
#    "NAME:Selections",
#    "Selections:="		, "Ground",
#    "NewPartsModelFlag:="	, "Model"
#  ],
#  [
#    "NAME:SheetThickenParameters",
#    "Thickness:="		, "0.035mm",
#    "BothSides:="		, False,
#    [
#     "NAME:ThickenAdditionalInfo",
#      [
#        "NAME:ShellThickenDirectionInfo",
#        "SampleFaceID:="	, 103741,
#        "ComponentSense:="	, True,
#        [
#          "NAME:PointOnSampleFace",
#          "X:="			, "2.20719cm",
#          "Y:="			, "2.20719cm",
#          "Z:="			, "20cm"
#        ],
#        [
#          "NAME:DirectionAtPoint",
#          "X:="			, "-0cm",
#          "Y:="			, "0cm",
#          "Z:="			, "1cm"
#        ]
#      ]
#    ]
#  ])